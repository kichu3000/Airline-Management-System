<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: headFragment"></head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <div th:replace="fragments/nav :: navbar"></div>
    
    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-lg">
            <div class="p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6">Admin Dashboard</h2>
                <nav class="space-y-2">
                    <a th:href="@{/admin}" 
                       th:classappend="${activeTab == 'home'} ? 'bg-blue-100 text-blue-700 border-r-4 border-blue-500' : 'text-gray-600 hover:bg-gray-100'"
                       class="flex items-center px-4 py-3 rounded-lg transition-colors">
                        <i data-lucide="home" class="w-5 h-5 mr-3"></i>
                        Dashboard
                    </a>
                    <a th:href="@{/admin/flights}" 
                       th:classappend="${activeTab == 'flights'} ? 'bg-blue-100 text-blue-700 border-r-4 border-blue-500' : 'text-gray-600 hover:bg-gray-100'"
                       class="flex items-center px-4 py-3 rounded-lg transition-colors">
                        <i data-lucide="plane" class="w-5 h-5 mr-3"></i>
                        Manage Flights
                    </a>
                    <a th:href="@{/admin/airplanes}" 
                       th:classappend="${activeTab == 'airplanes'} ? 'bg-blue-100 text-blue-700 border-r-4 border-blue-500' : 'text-gray-600 hover:bg-gray-100'"
                       class="flex items-center px-4 py-3 rounded-lg transition-colors">
                        <i data-lucide="airplane" class="w-5 h-5 mr-3"></i>
                        Manage Airplanes
                    </a>
                    <a th:href="@{/admin/users}" 
                       th:classappend="${activeTab == 'users'} ? 'bg-blue-100 text-blue-700 border-r-4 border-blue-500' : 'text-gray-600 hover:bg-gray-100'"
                       class="flex items-center px-4 py-3 rounded-lg transition-colors">
                        <i data-lucide="users" class="w-5 h-5 mr-3"></i>
                        All Users
                    </a>
                    <a th:href="@{/admin/bookings}" 
                       th:classappend="${activeTab == 'bookings'} ? 'bg-blue-100 text-blue-700 border-r-4 border-blue-500' : 'text-gray-600 hover:bg-gray-100'"
                       class="flex items-center px-4 py-3 rounded-lg transition-colors">
                        <i data-lucide="ticket" class="w-5 h-5 mr-3"></i>
                        Bookings
                    </a>
                    <a th:href="@{/admin/messages}" 
                       th:classappend="${activeTab == 'messages'} ? 'bg-blue-100 text-blue-700 border-r-4 border-blue-500' : 'text-gray-600 hover:bg-gray-100'"
                       class="flex items-center px-4 py-3 rounded-lg transition-colors">
                        <i data-lucide="mail" class="w-5 h-5 mr-3"></i>
                        Messages
                    </a>
                    <a th:href="@{/admin/profile}" 
                       th:classappend="${activeTab == 'profile'} ? 'bg-blue-100 text-blue-700 border-r-4 border-blue-500' : 'text-gray-600 hover:bg-gray-100'"
                       class="flex items-center px-4 py-3 rounded-lg transition-colors">
                        <i data-lucide="user" class="w-5 h-5 mr-3"></i>
                        Profile
                    </a>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
            <div class="p-8">
                <!-- Dashboard Home -->
                <div th:if="${activeTab == 'home'}">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">Admin Dashboard</h1>
                        <p class="text-gray-600">Welcome back, <span th:text="${admin.name}">Admin</span>!</p>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i data-lucide="plane" class="w-6 h-6"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Flights</p>
                                    <p class="text-2xl font-semibold text-gray-900" th:text="${flightCount ?: 0}">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i data-lucide="users" class="w-6 h-6"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Users</p>
                                    <p class="text-2xl font-semibold text-gray-900" th:text="${userCount ?: 0}">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                    <i data-lucide="ticket" class="w-6 h-6"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Bookings</p>
                                    <p class="text-2xl font-semibold text-gray-900" th:text="${bookingCount ?: 0}">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-red-100 text-red-600">
                                    <i data-lucide="mail" class="w-6 h-6"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">New Messages</p>
                                    <p class="text-2xl font-semibold text-gray-900" th:text="${messageCount ?: 0}">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Flights Management -->
                <div th:if="${activeTab == 'flights'}">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Manage Flights</h2>
                        <p class="text-gray-600">Add, edit, and manage flight schedules</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold">Add New Flight</h3>
                            <button onclick="toggleFlightForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                                Add Flight
                            </button>
                        </div>
                        
                        <form id="flightForm" class="hidden" th:action="@{/admin/flights}" method="post">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Flight Number</label>
                                    <input type="text" name="flightNumber" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Source</label>
                                    <input type="text" name="source" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Destination</label>
                                    <input type="text" name="destination" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Price</label>
                                    <input type="number" name="price" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Departure Time</label>
                                    <input type="datetime-local" name="departureTime" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Arrival Time</label>
                                    <input type="datetime-local" name="arrivalTime" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Seats</label>
                                    <input type="number" name="totalSeats" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3">
                                <button type="button" onclick="toggleFlightForm()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
                                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Add Flight</button>
                            </div>
                        </form>
                        
                        <!-- Flights Table -->
                        <div class="mt-6">
                            <h3 class="text-lg font-semibold mb-4">All Flights</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Flight</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Route</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Seats</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr th:each="flight : ${flights}">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900" th:text="${flight.flightNumber}">QJ-001</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" th:text="${flight.source + ' → ' + flight.destination}">NYC → LAX</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" th:text="${#temporals.format(flight.departureTime, 'MMM dd, HH:mm')}">Dec 15, 14:30</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" th:text="'$' + ${flight.price}">$299</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900" th:text="${flight.totalSeats}">180</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                                                <button class="text-red-600 hover:text-red-900">Delete</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Airplane Management -->
                <div th:if="${activeTab == 'airplanes'}">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Manage Airplanes</h2>
                        <p class="text-gray-600">Add and manage airplane fleet</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div th:if="${successMessage}" class="mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg" th:text="${successMessage}"></div>
                        <div th:if="${errorMessage}" class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg" th:text="${errorMessage}"></div>
                        
                        <form th:action="@{/admin/airplanes}" th:object="${newAirplane}" method="post" class="mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Airplane ID</label>
                                    <input type="text" th:field="*{airplaneId}" placeholder="QJ-001" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Model</label>
                                    <input type="text" th:field="*{model}" placeholder="Boeing 737" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Capacity</label>
                                    <input type="number" th:field="*{capacity}" min="1" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                    <select th:field="*{status}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">Select Status</option>
                                        <option value="Active">Active</option>
                                        <option value="Maintenance">Maintenance</option>
                                        <option value="Retired">Retired</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                                Add Airplane
                            </button>
                        </form>
                        
                        <!-- Airplanes Table -->
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Model</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Capacity</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr th:each="airplane : ${airplanes}">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" th:text="${airplane.airplaneId}">QJ-001</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${airplane.model}">Boeing 737</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${airplane.capacity}">180</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span th:classappend="${airplane.status == 'Active'} ? 'bg-green-100 text-green-800' : (${airplane.status == 'Maintenance'} ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800')" 
                                                  class="px-2 py-1 text-xs font-semibold rounded-full" th:text="${airplane.status}">Active</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${#temporals.format(airplane.createdAt, 'MMM dd, yyyy')}">Dec 15, 2024</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <form th:action="@{/admin/airplanes/delete/{id}(id=${airplane.id})}" method="post" style="display:inline;">
                                                <button type="submit" class="text-red-600 hover:text-red-900" onclick="return confirm('Are you sure?')">Delete</button>
                                            </form>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Users Management -->
                <div th:if="${activeTab == 'users'}">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">All Users</h2>
                        <p class="text-gray-600">Manage user accounts and permissions</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Joined</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr th:each="user : ${users}">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10">
                                                    <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                                        <span class="text-sm font-medium text-blue-600" th:text="${user.name.substring(0,1)}">J</span>
                                                    </div>
                                                </div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-medium text-gray-900" th:text="${user.name}">John Doe</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${user.email}">john@example.com</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span th:if="${user.isAdmin()}" class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Admin</span>
                                            <span th:unless="${user.isAdmin()}" class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">User</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Dec 15, 2024</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                                            <button class="text-red-600 hover:text-red-900">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Contact Messages -->
                <div th:if="${activeTab == 'messages'}">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Contact Messages</h2>
                        <p class="text-gray-600">View and manage customer inquiries</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">From</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Message</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr th:each="msg : ${messages}">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900" th:text="${msg.name}">John Doe</div>
                                            <div class="text-sm text-gray-500" th:text="${msg.email}">john@example.com</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${msg.subject}">Flight Inquiry</td>
                                        <td class="px-6 py-4 text-sm text-gray-900" th:text="${#strings.abbreviate(msg.message, 50)}">Message preview...</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" th:text="${#temporals.format(msg.createdAt, 'MMM dd, yyyy')}">Dec 15, 2024</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button class="text-blue-600 hover:text-blue-900 mr-3">View</button>
                                            <button class="text-green-600 hover:text-green-900">Reply</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Bookings Management -->
                <div th:if="${activeTab == 'bookings'}">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">All Bookings</h2>
                        <p class="text-gray-600">View and manage flight bookings</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <p class="text-gray-500">Booking management functionality will be implemented here.</p>
                    </div>
                </div>

                <!-- Profile -->
                <div th:if="${activeTab == 'profile'}">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Profile Settings</h2>
                        <p class="text-gray-600">Manage your admin profile</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <p class="text-gray-500">Profile editing form will be implemented here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="fragments/footer :: footerFragment"></div>
    
    <script>
        function toggleFlightForm() {
            const form = document.getElementById('flightForm');
            form.classList.toggle('hidden');
        }
    </script>
</body>
</html>
